---
- name: User management
  hosts: all
  gather_facts: false
  become: yes
  roles:
    - role: replace_default_user
      vars:
        default_user: alarm
        user: fionn
        password_salt: "n3mBfO4IivEt5zMI"
        password_string: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          35393839373235643461343434326265636430343662636431623664633464646237653032613766
          6561343734643932303435643262393232616532643161310a383461396264623839633462353862
          30656132336134393934346631383863653961346530623331383239613464613236653436333365
          3263303137646366320a356661383535326438303238323536376534376664663564383632396165
          6133

- name: Update and configure baseline system
  hosts: all
  become: yes
  roles:
    - role: base_system
      vars:
        hostname: macak

- name: Harden sshd
  hosts: all
  become: yes
  roles:
    - role: sshd
      vars:
        user: fionn

- name: Configure wireless networking
  hosts: all
  become: yes
  roles:
    - role: wireless_network
      vars:
        ssid: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          61386235613366353631663266623537313833393463343438653835643966386434353835346164
          3336393431393332653061626466626363336265303165300a306631303536353935646439333765
          39653430633930343532396539636536613138363135326336663239396434363865646366336638
          3633373732666434320a386561373361653335633964343361653866376661626661646232383566
          6532
        psk: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          37383030313239343663663761333266313862656561306239393333646163613135343133306439
          6564633464323261343233313732386133663932636562340a353463353535666233303737373066
          38643065356362356434363034613163373432643333623064356161393736326431373230313736
          6633363834616262610a306533353530623536376133343933383539656535353666346437663066
          65343339353034316232653135626136343730366133323833626366383532656336303334353865
          39666130656661353634313033306561396331626366303866653036633539363237643466653565
          31376434316637376162663865633864316237396264663033363563373966343333396665366237
          35303361343639393132

- name: Install dotfiles
  hosts: all
  roles:
    - role: dotfiles
      vars:
        github_username: "{{ ansible_user }}"

- name: Install and run Tor
  hosts: all
  become: yes
  roles:
    - role: tor

- name: Install, configure and run bitcoind
  hosts: all
  become: yes
  roles:
    - role: bitcoind

- name: Install, configure and run dynamic DNS service
  hosts: all
  roles:
    - role: ddns
      vars:
        github_username: "{{ ansible_user }}"
        ddns_hostname: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          66643733356632623539313837646134313137373562626631313234313066396633356462643634
          3062366565656138353238343437343638313531336537610a343738316137303763373433616139
          61643430343966653335613464643635656233623437633664323661623364633965396430303163
          6534343735353963350a646663333063366633386534666264306637383238316436616533386232
          63366232353836353935633765306562343631633930646235643231613431636161623531396530
          3631383464636633373630356435353363373265343634323666
        ddns_secret_key: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          63306166326233383035366262653936303239613061656630613863396135663964356633336165
          6233373962363866316566323035343166633037396633640a656436666430383030373335393134
          65386338616534613462346434616465336134623261626139393162336666393962346334646565
          3432366237613036610a373638653439333162306130616438623561383437326536306134366464
          35383236306335643937373635346231386533353261373436633466353533653864

- name: Check package integrity
  hosts: all
  become: yes
  tasks:
    - name: Check all files are present on the system
      command: pacman -Qk
      changed_when: false
